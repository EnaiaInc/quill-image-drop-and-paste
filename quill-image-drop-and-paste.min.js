(function(){var exports={};
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,a,i){if(a)e(t.prototype,a);if(i)e(t,i);return t}}();var _utils=require("./utils");var _utils2=_interopRequireDefault(_utils);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var ImageData=function(){function e(t,a){_classCallCheck(this,e);this.dataUrl=t;this.type=a}_createClass(e,[{key:"minify",value:function t(){var a=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new Promise(function(t,r){var n=i.maxWidth||800;var l=i.maxHeight||800;var o=i.quality||.8;if(!a.dataUrl){return r({message:"[error] QuillImageDropAndPaste: Fail to minify the image, dataUrl should not be empty."})}var s=new Image;s.onload=function(){var i=s.width;var r=s.height;if(i>r){if(i>n){s.height=r*n/i;s.width=n}}else{if(r>l){s.width=i*l/r;s.height=l}}var u=document.createElement("canvas");u.width=s.width;u.height=s.height;var f=u.getContext("2d");f.drawImage(s,0,0,s.width,s.height);var d=a.type||"image/png";var h=u.toDataURL(d,o);t(new e(h,d))};s.src=a.dataUrl})}},{key:"toFile",value:function e(t){if(!window.File){console.error("[error] QuillImageDropAndPaste: Your browser didnot support File API.");return null}return new File([this.toBlob()],t,{type:this.type})}},{key:"toBlob",value:function e(){var t=this.dataUrl.replace(/^[^,]+,/,"");var a=this.binaryStringToArrayBuffer(atob(t));return this.createBlob([a],{type:this.type})}},{key:"binaryStringToArrayBuffer",value:function e(t){var a=t.length;var i=new ArrayBuffer(a);var r=new Uint8Array(i);var n=-1;while(++n<a){r[n]=t.charCodeAt(n)}return i}},{key:"createBlob",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(typeof a==="string")a={type:a};try{return new Blob(t,a)}catch(e){if(e.name!=="TypeError")throw e;var i=typeof BlobBuilder!=="undefined"?BlobBuilder:typeof MSBlobBuilder!=="undefined"?MSBlobBuilder:typeof MozBlobBuilder!=="undefined"?MozBlobBuilder:WebKitBlobBuilder;var r=new i;for(var n=0;n<t.length;n++){r.append(t[n])}return r.getBlob(a.type)}}}]);return e}();var ImageDropAndPaste=function(){function e(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,e);this.quill=t;this.options=a;this.handleDrop=this.handleDrop.bind(this);this.handlePaste=this.handlePaste.bind(this);this.insert=this.insert.bind(this);this.quill.root.addEventListener("drop",this.handleDrop,false);this.quill.root.addEventListener("paste",this.handlePaste,false)}_createClass(e,[{key:"handleDrop",value:function e(t){var a=this;t.preventDefault();if(t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files.length){if(document.caretRangeFromPoint){var i=document.getSelection();var r=document.caretRangeFromPoint(t.clientX,t.clientY);if(i&&r){i.setBaseAndExtent(r.startContainer,r.startOffset,r.startContainer,r.startOffset)}}this.readFiles(t.dataTransfer.files,function(e,t){t=t||"image/png";if(typeof a.options.handler==="function"){a.options.handler.call(a,e,t,new ImageData(e,t))}else{a.insert.call(a,e,t)}},t)}}},{key:"handlePaste",value:function e(t){var a=this;if(t.clipboardData&&t.clipboardData.items&&t.clipboardData.items.length){this.readFiles(t.clipboardData.items,function(e,t){t=t||"image/png";if(typeof a.options.handler==="function"){a.options.handler.call(a,e,t,new ImageData(e,t))}else{a.insert(e,"image")}},t)}}},{key:"readFiles",value:function e(t,a,i){var r=this;Array.prototype.forEach.call(t,function(e){i.preventDefault();var t=e.type;if(t.match(/^image\/(gif|jpe?g|a?png|svg|webp|bmp)/i)){var n=new FileReader;n.onload=function(e){a(e.target.result,t)};var l=e.getAsFile?e.getAsFile():e;if(l instanceof Blob)n.readAsDataURL(l)}else if(t.match(/^text\/plain$/i)){e.getAsString(function(e){_utils2.default.urlIsImage(e).then(function(){r.insert(e,"image")}).catch(function(){r.insert(e,"text")})})}})}},{key:"insert",value:function e(t,a){var i=(this.quill.getSelection()||{}).index;if(i===undefined||i<0)i=this.quill.getLength();if(a==="image"){this.quill.insertEmbed(i,a,t,"user")}else if(a==="text"){this.quill.insertText(i,t,"user")}}}]);return e}();ImageDropAndPaste.ImageData=ImageData;exports.default=ImageDropAndPaste;
window.QuillImageDropAndPaste = ImageDropAndPaste;window.Quill.register('modules/imageDropAndPaste',ImageDropAndPaste)})();