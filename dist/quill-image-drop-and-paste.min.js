var QuillImageDropAndPaste=function(e){"use strict";var t={urlIsImage(e,t=3e3){return this.validURL(e)?/\.(jpeg|jpg|gif|png|webp|tiff|bmp)$/.test(e)?Promise.resolve(!0):new Promise(((r,a)=>{let i;const n=new Image;n.onerror=n.onabort=()=>{clearTimeout(i),a(!1)},n.onload=()=>{clearTimeout(i),r(!0)},i=setTimeout((()=>{n.src="//!/an/invalid.jpg",a(!1)}),t),n.src=e})):Promise.reject(!1)},validURL(e){try{return Boolean(new URL(e))}catch(e){return!1}},isHtmlText(e){let t=!1;return Array.prototype.forEach.call(e,(e=>{e.type.match(/^text\/html$/i)&&(t=!0)})),t},resolveDataUrl(e){let t="";return"string"==typeof e?t=e:e instanceof ArrayBuffer&&(t=this.arrayBufferToBase64Url(e)),t},binaryStringToArrayBuffer(e){const t=e.length,r=new ArrayBuffer(t),a=new Uint8Array(r);let i=-1;for(;++i<t;)a[i]=e.charCodeAt(i);return r},arrayBufferToBase64Url:e=>btoa(String.fromCharCode(...new Uint8Array(e))),copyText(e,t=document.body){const r=document.createElement("textarea"),a=document.activeElement;r.value=e,r.setAttribute("readonly",""),r.style.position="absolute",r.style.left="-9999px",r.style.fontSize="12pt";const i=document.getSelection();let n=!1;i&&i.rangeCount>0&&(n=i.getRangeAt(0)),t.append(r),r.select(),r.selectionStart=0,r.selectionEnd=e.length;let o=!1;try{o=document.execCommand("copy")}catch(e){}return r.remove(),i&&n&&(i.removeAllRanges(),i.addRange(n)),a&&a.focus(),o},isType:(e,t)=>Object.prototype.toString.call(e)===`[object ${t}]`};class r{constructor(e,t){this.dataUrl=e,this.type=t}minify(e){return new Promise(((a,i)=>{const n=e.maxWidth||800,o=e.maxHeight||800,l=e.quality||.8;if(!this.dataUrl)return i({message:"[error] QuillImageDropAndPaste: Fail to minify the image, dataUrl should not be empty."});const s=new Image;s.onload=()=>{const e=s.width,t=s.height;e>t?e>n&&(s.height=t*n/e,s.width=n):t>o&&(s.width=e*o/t,s.height=o);const d=document.createElement("canvas");d.width=s.width,d.height=s.height;const h=d.getContext("2d");if(h){h.drawImage(s,0,0,s.width,s.height);const e=this.type||"image/png",t=d.toDataURL(e,l);a(new r(t,e))}else i({message:"[error] QuillImageDropAndPaste: Fail to minify the image, create canvas context failure."})},s.src=t.resolveDataUrl(this.dataUrl)}))}toFile(e){return window.File?new File([this.toBlob()],e,{type:this.type}):(console.error("[error] QuillImageDropAndPaste: Your browser didnot support File API."),null)}toBlob(){const e=t.resolveDataUrl(this.dataUrl).replace(/^[^,]+,/,""),r=t.binaryStringToArrayBuffer(atob(e));return this.createBlob([r],{type:this.type})}createBlob(e,t){t||(t={}),"string"==typeof t&&(t={type:t});try{return new Blob(e,t)}catch(r){if("TypeError"!==r.name)throw r;const a=new("BlobBuilder"in window?window.BlobBuilder:"MSBlobBuilder"in window?window.MSBlobBuilder:"MozBlobBuilder"in window?window.MozBlobBuilder:window.WebKitBlobBuilder);for(let t=0;t<e.length;t++)a.append(e[t]);return a.getBlob(t.type)}}}class a{constructor(e,t){this.quill=e,this.option=t,this.handleDrop=this.handleDrop.bind(this),this.handlePaste=this.handlePaste.bind(this),this.insert=this.insert.bind(this),this.quill.root.addEventListener("drop",this.handleDrop,!1),this.quill.root.addEventListener("paste",this.handlePaste,!1)}handleDrop(e){if(e.preventDefault(),e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length){if(document.caretRangeFromPoint){const t=document.getSelection(),r=document.caretRangeFromPoint(e.clientX,e.clientY);t&&r&&t.setBaseAndExtent(r.startContainer,r.startOffset,r.startContainer,r.startOffset)}this.readFiles(e.dataTransfer.files,((e,a)=>{a=a||"image/png","function"==typeof this.option.handler?this.option.handler.call(this,e,a,new r(e,a)):this.insert.call(this,t.resolveDataUrl(e),a)}),e)}}handlePaste(e){if(e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length){if(t.isHtmlText(e.clipboardData.items))return;this.readFiles(e.clipboardData.items,((e,a)=>{a=a||"image/png","function"==typeof this.option.handler?this.option.handler.call(this,e,a,new r(e,a)):this.insert(t.resolveDataUrl(e),"image")}),e)}}readFiles(e,r,a){Array.prototype.forEach.call(e,(e=>{t.isType(e,"DataTransferItem")?this.handleDataTransfer(e,r,a):e instanceof File&&this.handleDroppedFile(e,r,a)}))}handleDataTransfer(e,r,a){const i=this,n=e.type;if(n.match(/^image\/(gif|jpe?g|a?png|svg|webp|bmp)/i)){a.preventDefault();const t=new FileReader;t.onload=e=>{e.target&&e.target.result&&r(e.target.result,n)};const i=e.getAsFile?e.getAsFile():e;i instanceof Blob&&t.readAsDataURL(i)}else n.match(/^text\/plain$/i)&&(a.preventDefault(),e.getAsString((e=>{t.urlIsImage(e).then((()=>{i.insert(e,"image")})).catch((()=>{i.insert(e,"text")}))})))}handleDroppedFile(e,t,r){const a=e.type;if(a.match(/^image\/(gif|jpe?g|a?png|svg|webp|bmp)/i)){r.preventDefault();const i=new FileReader;i.onload=e=>{e.target&&e.target.result&&t(e.target.result,a)},i.readAsDataURL(e)}}insert(e,t){let r,a=(this.quill.getSelection(!0)||{}).index;(void 0===a||a<0)&&(a=this.quill.getLength()),"image"===t?(r=a+1,this.quill.insertEmbed(a,t,e,"user")):"text"===t&&(r=a+e.length,this.quill.insertText(a,e,"user")),setTimeout((()=>{this.quill.setSelection(r)}))}}return a.ImageData=r,window.QuillImageDropAndPaste=a,"Quill"in window&&window.Quill.register("modules/imageDropAndPaste",a),e.ImageData=r,e.default=a,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=quill-image-drop-and-paste.min.js.map
